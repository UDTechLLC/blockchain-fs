# LoopbackZipFS (LZFS)

## Последовательность задач

1. **Простая реализация LZFS** - `24 часа` с полным покрытием тестами, или `14 часов` без тестов
    - [x] mount: распаковка архива во временную папку, монтирование временной папки как LoopbackFS, но тип сделать LZFS
    - [x] unmount: размонтирование временной папки, упаковка временной папки в архив (замена архива новой версией)
    - [x] create: создание пустой временной папки, упаковка ее в архив
    - [x] delete: удаление архива, который должен быть размонтирован
    - [x] put/get: как обычно?!
    - [ ] рефакторинг, ручное тестирование
    - [ ] проблемы создания тестов: технические (mount), слишком много можно написать тестов на разные случаи
2. **Альтернативы**, поиск и выбор, как избежать временной папки? - первый проход - `8 часов` - общее исследование, второй проход - **оценить** - конкретные фичи для экспериментов, третий подход - **оценить** - выбрать, добавить и развить фичи
    1. Сессии работы с файловой системой (любой?!)
    2. Кэширование (файловых систем, папок, файлов, фрагментов, конфигурации), разобрать эту тему
    3. Работа в памяти, ограничение размера
3. **Фрагментация, микрофрагментация**; пока без обфускации - первый проход - `8 часов` - фрагментация put/get без тестов, второй проход - **оценить** - микрофрагментация без тестов, третий подход - **оценить** - доработка фрагментации/микрофрагментации с полным покрытием тестами
    1. Переработать put/get для работы с фрагментами файлов, структура фрагмента, заголовок, что еще? Настраиваемый размер фрагмента: 8К (8192 байта) + заголовок
    2. Добавить микрофрагментацию, выключенную по умолчанию; размер микрофрагмента должен быть кратен размеру фрагмента, настраиваемый размер микрофрагмента: 2К (2048 байта)
4. **Улучшенная архивация**; поиск и выбор решения (решений) архивации для замены стандартного пакета; активно тестировать производительность решений - первый проход - `8 часов` - общее иследование вопроса тестирования производительности, на примере стандартного пакета, второй проход - `12 часов` - общее исследование вопроса архивации и производительности, а также других важных характеристик алгоритмом сжатия, третий проход - **оценить** - выбрать 3 лучших варианта и сделать эксперименты, затем? - внедрение выбора в LZFS
5. **Разрешения** (permissions); в основном это связано с FUSE операциями (operations); но возможно есть что-то еще, что будет влиять на разрешения (права доступа) - первый проход - 4 часа - общий обзор необходимости и возможности разрешений (прав доступа), 
6. Дальше будет видно: кросс-платформенность, обфускация, собственная библиотека wizefuse, какие то фичи от подобных файловых систем, стеганография, криптография, возможно это будет выделено в новую большую задачу на создание лучшего типа файловой системы

## Простая реализация LZFS

Разработал zip_util.go, в котором две функции UnzipFile и ZipFile. Требуется рефакторинг-доработка для работы с archive/zip. Требуется доработка для работы с archive/tar.

В будущем здесь же будут функции улучшенной архивации.

Реализовал mount/unmount и create/delete. Методы put/get работают без изменений.

Файл LZFS это архив (.zip, .tar, .tar.gz, .tar.bz2), имя которого должно начинаться с `_`. Возможно я сделаю иначе! С символа `_` будут распознаваться ZipFS файловые системы (временно!) для исследования работы с архивами в памяти.

Пробовал создать тест для mount, не получается из-за его особенности запуска в дочернем процессе, нужно подумать можно ли как то обойти эту проблему, чтобы тестировать mount.

Тестировать create/delete, unmount и put/get будет сложно без применения mount.

Идея! Тестировать методом запуска exec.Command, или схожим.

Таким образом порядок задач такой:

- [x] Проверить идею тестирования используя exec.Command - РАБОТАЕТ!
- [ ] Сделать рефакторинг zip_util.go
- [ ] Переработать идею с символом `_`
- [ ] Написать заглушки нескольких тестов (если идея сработает!)
- [ ] Добавить функции для работы с tar; включить их поддержку
- [ ] Писать тесты...

## Альтернативы

Работа в памяти...

Рассмотреть детальнее две идеи работы в памяти от go-fuse: ZipFS (read-only) и MemFS (read-write). Копнуть в другие направления.

В целом идея работы в памяти в том, чтобы реализовать или сессии работы (быстрая и краткосрочная работа), или кэширование (постоянное и частоиспользуемое), для обоих случаев нужна работа в памяти.

Сессии работы с файловой системой...

Идея в том, чтобы ограничить время работы с файловой системой, то есть она может самостоятельно размонтироваться через время... Тоесть система будет ставить монтирование на счетчик, что позволит размонтировать давно не используемую файловую систему... Стоит называть в будущем не файловая система, а раздел (partition) или область данных (bucket) как у Amazon S3.

Кэширование...

Идея в том, чтобы держать в памяти самые активные файлы (фрагменты)... Тоесть система должна сама следить за частотой работы put/get методов и помещать в кэш (работа в памяти, возможно постоянно, возможно сессионно) частоиспользуемые файлы (фрагменты)... Идея большая, нужно разбить на части и шаги внедрения.

## Фрагментация



## Улучшенная архивация

